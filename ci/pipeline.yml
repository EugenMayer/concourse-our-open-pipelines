groups:
- name: concourse-resources
  jobs:
  - build-docker-image-resource
  - build-concourse-static-resource-image
- name: concourse-docker-images
  jobs:
  - build-docker-image-concourse-worker
  - build-docker-image-concourse-configurator

jobs:
- name: build-docker-image-resource
  serial: true
  build_logs_to_retain: 100
  plan:
  - get: docker-image-resource
    trigger: true
  - task: build-docker-image-resource
    file: docker-image-resource/ci/build.yml
    input_mapping:
      docker-image-resource: docker-image-resource
    output_mapping:
      built-resource: docker-built-context
  - put: eugenmayer-docker-image-resource
    params:
      build: docker-built-context
      cache_tag: latest

- name: build-docker-image-concourse-worker
  serial: true
  build_logs_to_retain: 10
  plan:
  - get: docker-image-concourseci-worker-solid
    trigger: true
  - get: concourse-base-image
    trigger: true
    params:
      skip_download: true
  - put: concourse-worker-solid-image
    params:
      build: docker-image-concourseci-worker-solid
      cache_tag: latest

- name: build-docker-image-concourse-configurator
  serial: true
  build_logs_to_retain: 10
  plan:
  - get: docker-image-concourseci-configurator
    trigger: true
  - get: alpine-image
    trigger: true
    params:
      skip_download: true
  - put: concourse-configurator-image
    params:
      build: docker-image-concourseci-configurator
      cache_tag: latest

- name: build-concourse-static-resource-image
  serial: true
  build_logs_to_retain: 10
  plan:
  - get: concourse-static-resource
    trigger: true
  - get: alpine-edge-image
    trigger: true
    params:
      skip_download: true
  - put: concourse-static-resource-image
    params:
      build: concourse-static-resource
      cache_tag: latest

resources:
  - name: concourse-static-resource
    type: git
    source:
      uri: https://github.com/EugenMayer/concourse-static-resource
      branch: master

  - name: docker-image-resource
    type: git
    source:
      uri: https://github.com/EugenMayer/docker-image-resource-ng
      branch: develop

  - name: docker-image-concourseci-worker-solid
    type: git
    source:
      uri: https://github.com/EugenMayer/docker-image-concourseci-worker-solid
      branch: master

  - name: docker-image-concourseci-configurator
    type: git
    source:
      uri: https://github.com/EugenMayer/docker-image-concourse-configurator
      branch: master

  - name: concourse-base-image
    type: docker-image-resource-ng
    source:
      repository: concourse/concourse
      username: ((dockerhub.user))
      password: ((dockerhub.password))
      tag: 3.6.0

  - name: concourse-worker-solid-image
    type: docker-image-resource-ng
    source:
      repository: eugenmayer/concourse-worker-solid
      username: ((dockerhub.user))
      password: ((dockerhub.password))
      tag: 3.6.0

  - name: concourse-configurator-image
    type: docker-image-resource-ng
    source:
      repository: eugenmayer/concourse-configurator
      username: ((dockerhub.user))
      password: ((dockerhub.password))
      tag: latest


  - name: alpine-image
    type: docker-image-resource-ng
    source:
      repository: alpine
      username: ((dockerhub.user))
      password: ((dockerhub.password))
      tag: 3.6

  - name: alpine-edge-image
    type: docker-image-resource-ng
    source:
      repository: alpine
      username: ((dockerhub.user))
      password: ((dockerhub.password))
      tag: edge

  - name: eugenmayer-docker-image-resource
    type: docker-image-resource-ng
    source:
      repository: eugenmayer/concourse-docker-image-resource
      username: ((dockerhub.user))
      password: ((dockerhub.password))
      tag: latest

  - name: concourse-static-resource-image
    type: docker-image-resource-ng
    source:
      repository: eugenmayer/concourse-static-resource
      username: ((dockerhub.user))
      password: ((dockerhub.password))
      tag: latest

resource_types:
- name: docker-image-resource-ng
  type: docker-image
  privileged: true
  source:
    repository: eugenmayer/concourse-docker-image-resource
    tag: latest
